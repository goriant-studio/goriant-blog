---
import { undefined } from "astro:schema";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection, getEntry, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog-vi");

  return posts
  .map((entry) => {
    console.log('entry: ', entry);
    
    const slug = entry.id
      .split("/")
      .pop()!
      .replace(/\.(md|mdx)$/, "");

    return {
      params: { slug }, // ✅ string
      props: {
        id: entry.id, // dùng id để query lại
      },
    };
  });
}

const { id } = Astro.props;

// ✅ LẤY ENTRY ĐÚNG API
const post = await getEntry("blog-vi", id);

if (!post) {
  throw new Error(`Post not found: ${id}`);
}

// ✅ RENDER ĐÚNG API
const { Content } = await render(post);
---

<BaseLayout lang="vi">
  <main class="mx-auto max-w-3xl px-6 pt-40 pb-24">
    <a
      href="/vi/blog"
      class="text-sm text-white/60 hover:text-white transition"
    >
      ← Quay lại danh sách devlog
    </a>

    <header class="mt-6">
      <p class="text-sm text-white/50">
        {post.data.date.toLocaleDateString("vi-VN")}
      </p>

      <h1 class="mt-3 text-3xl sm:text-4xl font-extrabold text-white">
        {post.data.title}
      </h1>

      {post.data.description && (
        <p class="mt-4 text-white/70">
          {post.data.description}
        </p>
      )}
    </header>

    <article class="prose prose-invert prose-zinc mt-10 max-w-none">
      <Content />
    </article>
  </main>
</BaseLayout>