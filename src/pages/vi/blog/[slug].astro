---
import DevlogLayout from "../../../layouts/DevlogLayout.astro";
import { getCollection, getEntry, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog-vi");

  return posts.map((entry) => {
    const slug = entry.id.split("/").pop()?.replace(/\.(md|mdx)$/, "");
    return {
      params: { slug },
      props: { id: entry.id },
    };
  });
}

const { id } = Astro.props;

const post: any = await getEntry("blog-vi", id);
const { Content } = await render(post);

// LẤY POSTS CHO SIDEBAR
const posts = (await getCollection("blog-vi"))
  .filter((p) => p.data.game === "maze-escape")
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const currentSlug = post.id.split("/").pop()?.replace(/\.(md|mdx)$/, "");
---

<DevlogLayout
  lang="vi"
  posts={posts}
  currentSlug={currentSlug}
>
  <a
    href="/vi/blog"
    class="text-sm text-white/60 hover:text-white transition"
  >
    ← Quay lại danh sách devlog
  </a>

  <header class="mt-6">
    <p class="text-sm text-white/50">
      {post.data.date.toLocaleDateString("vi-VN")}
    </p>

    <h1 class="mt-3 text-3xl sm:text-4xl font-extrabold text-white">
      {post.data.title}
    </h1>

    {post.data.description && (
      <p class="mt-4 text-white/70">
        {post.data.description}
      </p>
    )}
  </header>

  <article class="mt-10">
    <Content />
  </article>
</DevlogLayout>
